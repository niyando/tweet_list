<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

<div class="my-4 border-bottom">
  <h3><%= @compilation.title %></h3>
  <p><%= @compilation.description %></p>  

  <% if current_user && current_user.id == @compilation.user.id %>
  <div class="float-right my-2">
    <%= link_to 'Edit', edit_compilation_path(@compilation), class:"btn btn-outline-primary" %>
    <%= link_to "Delete", compilation_path(@compilation), method: :delete, data: { confirm: 'Are you certain you want to delete this compilation?' }, class: "btn btn-outline-danger" %>
  </div>
  <% end %>
</div>

<% @compilation.tweets.each do |t| %>
<div class="my-4">
  <p><%= t.title %></p>
  <blockquote class="twitter-tweet" data-lang="en"><a href="<%= t.link %>"></a></blockquote>
</div>
<% end %>

<div class="border-bottom">
&nbsp;  
</div>
<div class="my-4">
  <p><a id="embed" class="btn btn-secondary" href="#">Embed</a></p>
  <div id="embed_code" style="display:none;">
    <p>Copy and paste the code below to embed this compilation to your website.</p>
    <div style="background-color:#F8F9FB;">
      <code id="embed">
      &lt;iframe src="<%= embed_compilation_url @compilation %>" frameborder="0" width="500px;" height="XYZpx;"&gt;&lt;/iframe&gt;
      </code>
    </div>
  </div>
</div>

<script>
  $(document).ready(function(){
    $('a#embed').on('click',function(e){
      e.preventDefault();
      var code = $('code#embed');
      text = code.text();
      code.text(text.replace('XYZ',document.body.clientHeight-150));
      $('div#embed_code').show();
      $('html, body').scrollTop( $(document).height() );
    })
  })
</script>